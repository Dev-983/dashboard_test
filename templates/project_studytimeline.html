<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>BPX Dashboard</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/mdi/css/materialdesignicons.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/ti-icons/css/themify-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/css/vendor.bundle.base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/font-awesome/css/font-awesome.min.css') }}">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/select2/select2.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/vendors/select2-bootstrap-theme/select2-bootstrap.min.css') }}">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/style.css') }}">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='assets/images/favicon.png') }}" />
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
  <style>
              .progress-container{
        position:relative;
        bottom:35px;z-index:0;
        }
    
        .milestone-container {
            display: flex;
            align-items: center;
            margin: 20px 0;overflow:scroll;height:150px;
            position: relative;border-bottom: 2px solid gray; padding: 20px 0px;
        }
        .progress-container {
            flex: 1;
            margin: 0 0px;
        }
        .progress-bar {
            height: 10px;
        }
        .milestone {
            position: relative;
            text-align: center;
            cursor: pointer;
        }
        .milestone .circle {
            width: 40px;
            height: 40px;
            border: 3px solid black;
            border-radius: 50%;
            display: inline-block;
            background-color: white;
            margin: 5px 0;z-index: 3;
        }
        .milestone .circle.completed {
            background-color: #7af75a;
        }
        .milestone .circle.completed::after {
    content: 'âœ”';
    color: white;
    font-size: 14px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

        .milestone .cost-input {
            width: 100px;
            text-align: center;
            display: inline-block;
        }
        .milestone .cost-input::before {
            content: "$";
        }
        .milestone .cost-input::after {
            content: "k";
        }

    .hidden {
            display: none;
        }

    </style>


  </head>

  <body>
    <div class="container-scroller">
      <!-- partial:../../partials/_navbar.html -->
      <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
          <a class="navbar-brand brand-logo" href="#" ><img src="{{ url_for('static', filename='assets/images/bpxlogo.svg') }}" alt="logo" />
          </a>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-stretch">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-menu"></span>
          </button>
          <div class="search-field d-none d-md-block">
            <form class="d-flex align-items-center h-100" action="#">
              <div class="input-group">
                <div class="input-group-prepend bg-transparent">
                  <i class="input-group-text border-0 mdi mdi-magnify"></i>
                </div>
                <input type="text" class="form-control bg-transparent border-0" placeholder="Search projects">
              </div>
            </form>
          </div>
          <ul class="navbar-nav navbar-nav-right">
         
            <li class="nav-item d-none d-lg-block full-screen-link">
              <a class="nav-link">
                <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link count-indicator dropdown-toggle" id="messageDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="mdi mdi-email-outline"></i>
                <span class="count-symbol bg-warning"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="messageDropdown">
                <h6 class="p-3 mb-0">Messages</h6>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face4.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Mark send you a message</h6>
                    <p class="text-gray mb-0"> 1 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face2.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Cregh send you a message</h6>
                    <p class="text-gray mb-0"> 15 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <img src="../../assets/images/faces/face3.jpg" alt="image" class="profile-pic">
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject ellipsis mb-1 font-weight-normal">Profile picture updated</h6>
                    <p class="text-gray mb-0"> 18 Minutes ago </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <h6 class="p-3 mb-0 text-center">4 new messages</h6>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-bs-toggle="dropdown">
                <i class="mdi mdi-bell-outline"></i>
                <span class="count-symbol bg-danger"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                <h6 class="p-3 mb-0">Notifications</h6>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-success">
                      <i class="mdi mdi-calendar"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Event today</h6>
                    <p class="text-gray ellipsis mb-0"> Just a reminder that you have an event today </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-warning">
                      <i class="mdi mdi-cog"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Settings</h6>
                    <p class="text-gray ellipsis mb-0"> Update dashboard </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-info">
                      <i class="mdi mdi-link-variant"></i>
                    </div>
                  </div>
                  <div class="preview-item-content d-flex align-items-start flex-column justify-content-center">
                    <h6 class="preview-subject font-weight-normal mb-1">Launch Admin</h6>
                    <p class="text-gray ellipsis mb-0"> New admin wow! </p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <h6 class="p-3 mb-0 text-center">See all notifications</h6>
              </div>
            </li>
            <li class="nav-item nav-logout d-none d-lg-block">
              <a class="nav-link" href="#">
                <i class="mdi mdi-power"></i>
              </a>
            </li>
            <li class="nav-item nav-settings d-none d-lg-block">
              <a class="nav-link" href="#">
                <i class="mdi mdi-format-line-spacing"></i>
              </a>
            </li>
          </ul>
          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
            <span class="mdi mdi-menu"></span>
          </button>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:../../partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">

            <li class="nav-item">
              <a class="nav-link" href="/">
                <span class="menu-title">Dashboard</span>
                <i class="mdi mdi-home menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/projectoverview">
                <span class="menu-title">Project Overview</span>
                <i class="mdi mdi-clipboard-outline menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/finance">
                <span class="menu-title">Financial Foecast</span>
                <i class="mdi mdi-chart-line menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/projectactivity">
                <span class="menu-title">Project Activity</span>
                <i class="mdi  mdi-clipboard-text menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/studytimeline">
                <span class="menu-title">Project Study</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/notes_issues">
                <span class="menu-title">Notes & Issue</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/project_milestone">
                <span class="menu-title">Projectt Milestone</span>
                <i class="mdi mdi-calendar-check menu-icon"></i>
              </a>
            </li>

          </ul>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header">
              <h3 class="page-title"> Project Study Timeline </h3>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Project Study Timeline </li>
                </ol>
              </nav>
            </div>
            <div class="row">
              <div class="col-12 grid-margin">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">Project Study</h4>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Add</button>
<button id='btn_save' class="btn btn-success">Save</button>

<div class="form-check form-switch">
  <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault"  style="width: 5em;height:35px;"} />
  <label class="form-check-label" for="flexSwitchCheckDefault"></label>
</div>

<div id="milestoneContainer">
    <!-- Milestones will be added here -->
</div>


<div id="portfolioviewContainer" class="hidden">
      <div id="chart_div" style="width: 100%; height: 400px;margin-top: 50px;"></div>
    <!-- portfolioviewContainer will be added here -->
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel">Add Milestones</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="number" id="milestoneCount" class="form-control" placeholder="Enter Total Cost...." required="required">
            </div>
            <div class="row">
              <div class="col-6 grid-margin">Start Date<input type="date" id='d1' class="form-control"></div>
              <div class="col-6 grid-margin">Ent Date<input type="date" id='d2' class="form-control"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btndanger">Close</button>
                <button type="button" class="btn btn-primary" onclick="addMilestones()">Add</button>
            </div>
        </div>
    </div>
</div>

                    
                    <!-- <div id="example4.2" style="height: 700px;"></div> -->
                  </div>
                </div>
              </div>

   
              <div class="col-md-6 grid-margin stretch-card">
                <div class="card">

            </div>
          </div>
    <!-- The Modal -->
<!-- <div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

       Modal Header 
      <div class="modal-header">
        <h4 class="modal-title">Project study</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

     
      <div class="modal-body">
          <div class="mb-3 mt-3">
              <label  class="form-label">Cost Estimate:</label>
              <input type="number" class="form-control" id="costetimate" placeholder="Enter cost Estimate" >
          </div>
         <div class="row">
            <div class="col">
              <input type="date" class="form-control" placeholder="Enter Start Date" id='d1'>
            </div>
          <div class="col">
             <input type="date" class="form-control" placeholder="Enter Stop Date" id='d2'>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="btnclose">Close</button>
        <button type="button" id='btn_modalsave' class="btn btn-success">Save</button>
      </div>

    </div>
  </div>
</div> -->
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted text-center text-sm-left d-block d-sm-inline-block"><h4>BPX Team</h4></span>
              <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">helpdesk@bpx.ai</span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="{{ url_for('static', filename='assets/vendors/js/vendor.bundle.base.js') }}"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="{{ url_for('static', filename='assets/vendors/select2/select2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/vendors/typeahead.js/typeahead.bundle.min.js') }}"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="{{ url_for('static', filename='assets/js/off-canvas.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/misc.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/settings.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/todolist.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/jquery.cookie.js') }}"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="{{ url_for('static', filename='assets/js/file-upload.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/typeahead.js') }}"></script>
    <script src="{{ url_for('static', filename='assets/js/select2.js') }}"></script>
    <!-- End custom js for this page -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<!-- Add your JavaScript code here -->
<script>       
 document.getElementById('flexSwitchCheckDefault').addEventListener('change', function () {
            const milestoneContainer = document.getElementById('milestoneContainer');
            const portfolioviewContainer = document.getElementById('portfolioviewContainer');

            if (this.checked) {
                milestoneContainer.classList.add('hidden');
                portfolioviewContainer.classList.remove('hidden');

        google.charts.load('current', {'packages':['gantt']});
        google.charts.setOnLoadCallback(drawChart);

            } else {
                milestoneContainer.classList.remove('hidden');
                portfolioviewContainer.classList.add('hidden');
            }
        });

  var permonth_cost=0
          function calculateMonthsBetweenDates(startDate, endDate) {
            var start = new Date(startDate);
            var end = new Date(endDate);

            var years = end.getFullYear() - start.getFullYear();
            var months = (end.getMonth() - start.getMonth()) + (years * 12);

            // Adjust for partial months
            if (end.getDate() < start.getDate()) {
                months--;
            }

            return months;
        }
</script> 
<script>
 
  function addMilestones() {
    $('#btndanger').click();
    const milestoneCount = document.getElementById('milestoneCount').value;
    const d1 = document.getElementById('d1').value;
    const d2 = document.getElementById('d2').value;
    if (!milestoneCount || !d1 || !d2) {
        alert('Please fill in all fields.');
        return;
    }

    let month = calculateMonthsBetweenDates(d1, d2);
    let cost = Math.round(milestoneCount / month);
    const milestoneContainer = document.getElementById('milestoneContainer');

    const container = document.createElement('div');
    container.classList.add('milestone-container');

    for (let i = 0; i < month; i++) {
        createMilestone(container, i + 1, cost);
    }

    milestoneContainer.insertBefore(container, milestoneContainer.firstChild);

    const modal = bootstrap.Modal.getInstance(document.getElementById('myModal'));
    modal.hide();
}

function createMilestone(container, milestoneNumber, cost = '', date = '', completed = false) {
    const milestone = document.createElement('div');
    milestone.classList.add('milestone');
    milestone.draggable = !completed;

    const dateIcon = document.createElement('i');
    dateIcon.classList.add('mdi', 'mdi-calendar');
    dateIcon.style.marginBottom = '5px';
    dateIcon.addEventListener('click', function() {
        addDateInput(milestone, dateIcon, date);
    });

    const costIcon = document.createElement('i');
    costIcon.classList.add('mdi', 'mdi-chevron-down');
    costIcon.style.marginBottom = '5px';
    costIcon.addEventListener('click', function() {
        addCostInput(milestone, costIcon, cost);
    });

    const circle = document.createElement('div');
    circle.classList.add('circle');
    if (completed) {
        circle.classList.add('completed');
    }

    milestone.appendChild(dateIcon);
    milestone.appendChild(costIcon);
    milestone.appendChild(circle);

    const progressContainer = document.createElement('div');
    progressContainer.classList.add('progress-container');

    const progressBar = document.createElement('div');
    progressBar.classList.add('progress-bar', 'bg-secondary');
    progressBar.style.width = '100%';

    progressContainer.appendChild(progressBar);
    milestone.appendChild(progressContainer);

    container.appendChild(milestone);

    milestone.addEventListener('dragstart', dragStart);
    milestone.addEventListener('dragover', dragOver);
    milestone.addEventListener('drop', drop);
    milestone.addEventListener('dragend', dragEnd);
    milestone.addEventListener('click', () => updateProgress(milestone));
}

function addDateInput(milestone, dateIcon, date) {
    const dateInput = document.createElement('input');
    dateInput.type = 'date';
    dateInput.classList.add('form-control');
    dateInput.value = date;
    dateInput.style.marginBottom = '-63px';
    dateInput.style.position = 'relative';
    dateInput.style.bottom = '55px';
    dateInput.style.opacity = '0'; // Initial opacity
    dateInput.style.transition = 'opacity 0.5s'; // Smooth transition
    setTimeout(() => dateInput.style.opacity = '1', 0); // Trigger the transition

    const closeDateIcon = document.createElement('i');
    closeDateIcon.classList.add('mdi', 'mdi-close');
    closeDateIcon.style.marginBottom = '5px';
    closeDateIcon.style.marginLeft = '90px';
    closeDateIcon.addEventListener('click', function() {
        milestone.removeChild(dateInput);
        milestone.removeChild(closeDateIcon);
        dateIcon.style.display = 'inline';
    });

    milestone.insertBefore(dateInput, dateIcon.nextSibling);
    milestone.insertBefore(closeDateIcon, dateIcon.nextSibling);
    dateIcon.style.display = 'none';
}

function addCostInput(milestone, costIcon, cost) {
    const costInput = document.createElement('input');
    costInput.type = 'text';
    costInput.classList.add('form-control', 'cost-input');
    costInput.placeholder = 'Cost';
    costInput.value = cost;
    costInput.style.marginBottom = '-8px';
    costInput.style.position = 'relative';
    costInput.style.top = '10px';
    costInput.style.opacity = '0'; // Initial opacity
    costInput.style.transition = 'opacity 0.5s'; // Smooth transition
    setTimeout(() => costInput.style.opacity = '1', 0); // Trigger the transition

    const closeCostIcon = document.createElement('i');
    closeCostIcon.classList.add('mdi', 'mdi-close');
    closeCostIcon.style.marginBottom = '5px';
    closeCostIcon.addEventListener('click', function() {
        milestone.removeChild(costInput);
        milestone.removeChild(closeCostIcon);
        costIcon.style.display = 'inline';
    });

    milestone.insertBefore(costInput, costIcon.nextSibling);
    milestone.insertBefore(closeCostIcon, costIcon.nextSibling);
    costIcon.style.display = 'none';
}

function dragStart(e) {
    if (!this.draggable) {
        e.preventDefault();
        return;
    }
    draggedItem = this;
    setTimeout(() => this.style.display = 'none', 0);
}

function dragOver(e) {
    e.preventDefault();
    if (!draggedItem) return;

    const overItem = this;
    if (!overItem.draggable) {
        e.preventDefault();
        return;
    }
}

function drop(e) {
    e.preventDefault();
    if (!draggedItem || !this.draggable) return;

    this.parentNode.insertBefore(draggedItem, this);
}

function dragEnd() {
    setTimeout(() => this.style.display = 'block', 0);
    draggedItem = null;
}

function updateProgress(milestone) {
    const circle = milestone.querySelector('.circle');
    circle.classList.toggle('completed');
    milestone.draggable = !circle.classList.contains('completed');  // Toggle dragging based on completion
}

document.getElementById('btn_save').addEventListener('click', function () {
    const milestoneContainer = document.getElementById('milestoneContainer');
    const containers = milestoneContainer.getElementsByClassName('milestone-container');
    const data = [];

    Array.from(containers).forEach(container => {
        const milestones = container.getElementsByClassName('milestone');
        const containerData = [];

        Array.from(milestones).forEach((milestone, index) => {
            const costInput = milestone.querySelector('input[type="text"]');
            const dateInput = milestone.querySelector('input[type="date"]');
            const completed = milestone.querySelector('.circle').classList.contains('completed');
            const cost = costInput ? costInput.value : '';
            const date = dateInput ? dateInput.value : '';
            containerData.push({ milestone: index + 1, cost: cost, date: date, completed: completed });
        });

        data.push(containerData);
    });

    fetch('/save_data2', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        alert('Data saved successfully');
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

function loadData() {
    fetch('/load_data2')
    .then(response => response.json())
    .then(data => {
        const milestoneContainer = document.getElementById('milestoneContainer');

        data.forEach(containerData => {
            const container = document.createElement('div');
            container.classList.add('milestone-container');

            containerData.forEach((item, index) => {
                createMilestone(container, item.milestone, item.cost, item.date, item.completed);
            });

            milestoneContainer.appendChild(container);
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

document.addEventListener('DOMContentLoaded', loadData);


/*
function addMilestones() {
    $('#btndanger').click();
    const milestoneCount = document.getElementById('milestoneCount').value;
    const d1 = document.getElementById('d1').value;
    const d2 = document.getElementById('d2').value;
    if (!milestoneCount || !d1 || !d2) {
        alert('Please fill in all fields.');}

    let month = calculateMonthsBetweenDates(d1, d2);
    let cost = Math.round(milestoneCount / month);
    const milestoneContainer = document.getElementById('milestoneContainer');

    const container = document.createElement('div');
    container.classList.add('milestone-container');

    for (let i = 0; i < month; i++) {
        createMilestone(container, i + 1, cost);
    }

    milestoneContainer.insertBefore(container, milestoneContainer.firstChild);

    const modal = bootstrap.Modal.getInstance(document.getElementById('myModal'));
    modal.hide();

}

function createMilestone(container, milestoneNumber, cost = '', date = '', completed = false) {
    const milestone = document.createElement('div');
    milestone.classList.add('milestone');
    milestone.draggable = !completed;

    const dateInput = document.createElement('input');
    dateInput.type = 'date';
    dateInput.classList.add('form-control');
    dateInput.value = date;
    dateInput.style.marginBottom = '5px';

    const circle = document.createElement('div');
    circle.classList.add('circle');
    if (completed) {
        circle.classList.add('completed');
    }

    const costInput = document.createElement('input');
    costInput.type = 'text';
    costInput.classList.add('form-control', 'cost-input');
    costInput.placeholder = 'Cost';
    costInput.value = `${cost}`;  // Format the cost input

    milestone.appendChild(dateInput);
    milestone.appendChild(circle);

    const progressContainer = document.createElement('div');
    progressContainer.classList.add('progress-container');

    const progressBar = document.createElement('div');
    progressBar.classList.add('progress-bar', 'bg-secondary');
    //progressBar.style.width = completed ? '100%' : '0%';  // Set initial progress bar width
    progressBar.style.width = '100%';

    progressContainer.appendChild(progressBar);
    milestone.appendChild(progressContainer);
    milestone.appendChild(costInput);

    container.appendChild(milestone);

    milestone.addEventListener('dragstart', dragStart);
    milestone.addEventListener('dragover', dragOver);
    milestone.addEventListener('drop', drop);
    milestone.addEventListener('dragend', dragEnd);
    milestone.addEventListener('click', () => updateProgress(milestone));
}

function createProgressBar(container) {
    const progressContainer = document.createElement('div');
    progressContainer.classList.add('progress-container');

    const progressBar = document.createElement('div');
    progressBar.classList.add('progress-bar', 'bg-success');
    progressBar.style.width = '0%';

    progressContainer.appendChild(progressBar);
    container.appendChild(progressContainer);
}

let draggedItem = null;

function dragStart(e) {
    if (!this.draggable) {
        e.preventDefault();
        return;
    }
    draggedItem = this;
    setTimeout(() => this.style.display = 'none', 0);
}

function dragOver(e) {
    e.preventDefault();
    if (!draggedItem) return;

    const overItem = this;
    if (!overItem.draggable) {
        e.preventDefault();
        return;
    }
}

function drop(e) {
    e.preventDefault();
    if (!draggedItem || !this.draggable) return;

    this.parentNode.insertBefore(draggedItem, this);
}

function dragEnd() {
    setTimeout(() => this.style.display = 'block', 0);
    draggedItem = null;
}

function updateProgress(milestone) {
    const circle = milestone.querySelector('.circle');
    circle.classList.toggle('completed');
    milestone.draggable = !circle.classList.contains('completed');  // Toggle dragging based on completion

    const milestoneContainer = milestone.parentNode;
    const milestones = milestoneContainer.getElementsByClassName('milestone');
    const progressBars = milestoneContainer.getElementsByClassName('progress-bar');

    // Array.from(milestones).forEach((ms, index) => {
    //     if (ms.querySelector('.circle').classList.contains('completed')) {
    //         if (index < progressBars.length) {
    //             progressBars[index].style.width = '100%';
    //         }
    //     } else {
    //         if (index < progressBars.length) {
    //             progressBars[index].style.width = '0%';
    //         }
    //     }
    // });
}

document.getElementById('btn_save').addEventListener('click', function () {
    const milestoneContainer = document.getElementById('milestoneContainer');
    const containers = milestoneContainer.getElementsByClassName('milestone-container');
    const data = [];

    Array.from(containers).forEach(container => {
        const milestones = container.getElementsByClassName('milestone');
        const containerData = [];

        Array.from(milestones).forEach((milestone, index) => {
            const costInput = milestone.querySelector('input[type="text"]');
            const dateInput = milestone.querySelector('input[type="date"]');
            const completed = milestone.querySelector('.circle').classList.contains('completed');
            containerData.push({ milestone: index + 1, cost: costInput.value, date: dateInput.value, completed: completed });
        });

        data.push(containerData);
    });

    fetch('/save_data2', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        alert('Data saved successfully');
    })
    .catch(error => {
        console.error('Error:', error);
    });
});
*/
function loadData() {
    fetch('/load_data2')
    .then(response => response.json())
    .then(data => {
        const milestoneContainer = document.getElementById('milestoneContainer');

        data.forEach(containerData => {
            const container = document.createElement('div');
            container.classList.add('milestone-container');

            containerData.forEach((item, index) => {
                createMilestone(container, item.milestone, item.cost, item.date, item.completed);
            });

            milestoneContainer.appendChild(container);
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

document.addEventListener('DOMContentLoaded', loadData);

</script>
<script type="text/javascript">

      function drawChart() {
            fetch('/load_data2')
                .then(response => response.json())
                .then(milestoneData => {
                    const data = new google.visualization.DataTable();
                    data.addColumn('string', 'Task ID');
                    data.addColumn('string', 'Task Name');
                    data.addColumn('string', 'Resource');
                    data.addColumn('date', 'Start Date');
                    data.addColumn('date', 'End Date');
                    data.addColumn('number', 'Duration');
                    data.addColumn('number', 'Percent Complete');
                    data.addColumn('string', 'Dependencies');

                    let taskId = 1;
                    milestoneData.forEach((container, index) => {
                        container.forEach(milestone => {
                            if (milestone.date) {
                                const startDate = new Date(milestone.date);
                                const endDate = new Date(milestone.date);
                                endDate.setDate(startDate.getDate() + 1); // Assuming 1-day milestones
                                const percentComplete = milestone.completed ? 100 : 0;
                                data.addRow([
                                    'Task' + taskId,
                                    'Milestone ' + milestone.milestone,
                                    'Container ' + (index + 1),
                                    startDate,
                                    endDate,
                                    null,
                                    percentComplete,
                                    null
                                ]);
                                taskId++;
                            }
                        });
                    });

                    const options = {
                        height: 400,
                        gantt: {
                            trackHeight: 30
                        }
                    };

                    const chart = new google.visualization.Gantt(document.getElementById('chart_div'));
                    chart.draw(data, options);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }
</script>

  </body>
</html>